# drag2frames - 视频帧提取工具

## 简介

**drag2frames** 是一个强大的 Win32 视频帧提取工具，支持批量处理视频文件，将视频转换为图像序列。该工具提供了直观的拖拽操作界面、灵活的帧采样控制、以及 ROI（感兴趣区域）裁剪功能。

---

## 主要功能特性

### 1. 多种输入模式
- **单文件模式**：拖入一个视频文件进行处理
- **目录扫描模式**：拖入一个目录，自动扫描并处理该目录下的所有视频文件
- **多文件批量模式**：同时拖入多个视频文件进行批量处理

### 2. 灵活的帧采样
- **按间隔采样**：使用"跳帧数"参数控制帧的采样密度
  - `0`：保存所有帧
  - `1`：每隔 1 帧保存一次（保存第 1、3、5... 帧）
  - `N`：每隔 N 帧保存一次
- 顺序读取视频帧，确保每一帧都被正确解码

### 3. ROI 区域裁剪
- 在单个视频或分辨率一致的批量视频中启用
- 通过指定坐标（X1, Y1, X2, Y2）定义感兴趣区域
- 实时在预览窗口显示红色裁剪框，所见即所得
- 自动显示 ROI 区域的像素尺寸 (宽x高)

### 4. 实时预览
- 显示视频第一帧作为预览
- 在预览中直观地显示 ROI 裁剪框
- 显示视频元数据：分辨率、时长、帧率

### 5. 自动开始模式
- 勾选"自动开始"后，拖入视频文件即自动开始提取
- 无需手动点击"开始提取"按钮

### 6. 进度反馈
- 实时显示当前处理的文件和进度
- 进度条显示当前视频的处理进度（0-100%）
- 处理完毕后显示完成提示

---

## 界面说明

### 顶部提示栏
显示当前应用状态，默认显示"请拖入 [视频文件] 或 [目录] ..."

### 源路径
- 显示拖入的视频文件路径或目录路径
- 批量模式下显示"[多文件模式] 共 X 个视频文件"

### 输出目录
- 指定提取图像的保存位置
- 单个视频模式：默认为视频文件所在目录，文件名为视频名（无扩展名）
- 目录模式：默认为源目录名 + "_frames" 后缀
- 支持点击"..."按钮自定义输出目录

### 跳帧数
- 控制帧采样间隔
- 输入 0 表示保存所有帧，输入 N 表示每隔 N 帧保存一次
- 默认值：0（保存所有帧）

### ROI 区域
- 四个输入框分别表示：X1, Y1（左上角坐标）和 X2, Y2（右下角坐标）
- 单位：像素
- 默认值：整个视频画面
- 分辨率不一致的批量模式下此功能被禁用
- 右侧显示当前 ROI 区域的尺寸，例如 "(1920x1080)"

### 预览窗口
- 显示视频第一帧的缩略图
- 灰色背景表示预览未加载
- 红色矩形框表示 ROI 裁剪区域

### 状态栏
- 显示当前处理信息（处理第几个文件，当前操作）
- 处理完毕后显示"所有任务已完成！"

### 进度条
- 实时显示当前视频的处理进度
- 范围：0% - 100%

---

## 使用流程

### 基本使用步骤

#### 步骤 1：启动应用
运行 `drag2frames.exe` 启动应用。

#### 步骤 2：设置输出目录（可选）
- 点击输出目录右侧的 "..." 按钮选择自定义保存位置
- 或接受默认位置

#### 步骤 3：设置提取参数（可选）
- **跳帧数**：默认 0（保存所有帧），可根据需要调整
- **ROI 区域**：默认为整个画面，可根据需要调整坐标

#### 步骤 4：拖入视频
将视频文件或目录拖入预览窗口区域，应用会自动：
1. 扫描和检测视频文件
2. 获取视频信息（分辨率、时长、帧率）
3. 加载第一帧作为预览
4. 启用对应的功能选项

#### 步骤 5：开始提取
- **自动模式**：勾选"自动开始"后，拖入视频即自动开始处理
- **手动模式**：点击"开始提取"按钮手动开始

#### 步骤 6：等待完成
- 观察进度条和状态信息
- 处理完毕后会收到完成提示

---

## 使用场景示例

### 场景 1：提取视频所有帧

1. 拖入一个 MP4 视频文件
2. 跳帧数保持 0
3. 点击"开始提取"
4. 所有帧会保存到输出目录

**生成文件名格式**：`视频名_00001.jpg`, `视频名_00002.jpg`, ...

---

### 场景 2：稀疏采样（每隔 10 帧保存一次）

1. 拖入视频文件
2. 设置跳帧数为 10
3. 点击"开始提取"
4. 只有第 1、12、23... 帧会被保存

**适用场景**：
- 视频分析、审核
- 减少存储空间需求
- 快速生成关键帧预览

---

### 场景 3：ROI 裁剪提取

1. 拖入视频文件（或分辨率一致的多个视频）
2. 在 ROI 区域输入坐标，例如：
   - X1 = 100, Y1 = 100
   - X2 = 1800, Y2 = 1000
3. 观察预览窗口中的红色裁剪框
4. 点击"开始提取"
5. 只有裁剪区域内的内容会被保存

**适用场景**：
- 去除黑边/字幕条
- 关注特定区域
- 减少存储/计算成本

---

### 场景 4：批量处理多个视频

#### 方法 A：拖入目录
1. 创建一个文件夹，放入多个视频文件（如 `videos/`）
2. 拖入该文件夹
3. 应用会自动扫描该目录下的所有支持的视频文件
4. 设置参数后点击"开始提取"
5. 每个视频的帧会保存到各自的子目录

#### 方法 B：拖入多个视频文件
1. 在文件管理器中选中多个视频文件（Ctrl+Click）
2. 一起拖入应用
3. 应用进入"多文件模式"
4. 设置参数后点击"开始提取"
5. 所有视频同时处理

**输出目录结构**（目录模式示例）：
```
videos_frames/
├── video1/
│   ├── video1_00001.jpg
│   ├── video1_00002.jpg
│   └── ...
├── video2/
│   ├── video2_00001.jpg
│   ├── video2_00002.jpg
│   └── ...
└── ...
```

---

## 支持的视频格式

应用支持以下常见视频格式：
- `.mp4` - MPEG-4 视频
- `.avi` - Audio Video Interleave
- `.mov` - QuickTime 视频
- `.mkv` - Matroska 视频
- `.wmv` - Windows Media Video
- `.flv` - Flash 视频
- `.mpg` - MPEG 视频

---

## 输出文件命名规则

### 单文件/多文件模式
```
输出目录/视频文件名/视频文件名_帧序号.jpg
```

**示例**：
- 视频：`C:\Videos\sample.mp4`
- 输出目录：`C:\Videos\sample_frames`
- 生成文件：
  - `sample_frames/sample/sample_00001.jpg`
  - `sample_frames/sample/sample_00002.jpg`
  - `sample_frames/sample/sample_00003.jpg`

### 目录批量模式
```
输出目录/各视频子目录/视频文件名_帧序号.jpg
```

**示例**：
- 源目录：`C:\Videos`
- 输出目录：`C:\Videos_frames`
- 生成文件：
  - `Videos_frames/video1/video1_00001.jpg`
  - `Videos_frames/video2/video2_00001.jpg`

---

## 高级选项

### 分辨率一致性检测
- 在批量模式下，应用会自动检测所有视频的分辨率
- **分辨率一致**：ROI 功能可用，显示"可裁剪"提示
- **分辨率不一致**：ROI 功能禁用，显示"裁剪已禁用"提示，防止裁剪坐标错误

### 中断处理
- 处理过程中点击"停止"按钮可中止当前视频的处理
- 已保存的帧文件会被保留

### 自动开始模式
- 勾选后，每次拖入视频都会自动开始提取
- 适合需要快速连续处理多个视频的用户

---

## 常见问题 (FAQ)

### Q: 处理大文件时速度很慢，如何加快？

**A**: 
1. 增加跳帧数，减少需要保存的帧数量
2. 启用 ROI 裁剪，减少图像尺寸
3. 使用更高速的存储设备（SSD）
4. 确保输出目录有足够的磁盘空间

---

### Q: 能否修改输出图像的格式（如保存为 PNG）？

**A**: 当前版本固定输出为 JPEG 格式。如需修改，可以联系开发者或使用第三方工具进行批量转换。

---

### Q: 提取后的图像大小为何不同？

**A**: 可能原因：
1. 启用了 ROI 裁剪，裁剪后尺寸较小
2. 视频本身的分辨率不同（检查源视频）

---

### Q: 如何批量处理多个目录的视频？

**A**:
1. 方法 1：依次拖入每个目录，连续处理
2. 方法 2：将所有视频文件统一放在一个目录中，一次性拖入处理

---

### Q: 拖入视频后没有反应？

**A**: 可能原因及解决方案：
1. 检查文件格式是否被支持（见"支持的视频格式"部分）
2. 视频文件可能已损坏，尝试用其他视频播放器打开验证
3. 系统缺少 Media Foundation 解码器，尝试安装 Windows 更新或相关编码包
4. 文件路径过长或包含特殊字符，尝试将文件移到简单路径

---

### Q: 能否同时处理多个任务？

**A**: 当前版本不支持同时处理多个独立任务。应用会按顺序处理拖入的所有视频文件，完成后才能开始新的任务。

---

### Q: ROI 坐标输入有什么限制？

**A**:
- X1、Y1 必须小于 X2、Y2
- 坐标必须为非负整数
- 坐标应在视频分辨率范围内（超出会被自动调整）
- 在分辨率不一致的批量模式下无法使用 ROI 功能

---

## 技术信息

### 系统要求
- **操作系统**：Windows 7 或更高版本
- **依赖库**：
  - Windows Media Foundation（用于视频解码）
  - GDI+ (Gdiplus)（用于图像处理）
- **处理器**：支持 x86 或 x64 架构

### 性能指标
- **单帧处理时间**：根据分辨率和帧率变化（通常 1-50ms）
- **内存占用**：约 50-200MB（取决于图像尺寸和操作参数）

---

## 快捷技巧

1. **快速切换输出目录**：点击"..."按钮，无需重新拖入视频
2. **快速调整参数**：在处理中也可修改未来的处理参数
3. **预留空间**：高分辨率视频全帧提取需要大量磁盘空间，提前检查
4. **批量操作**：先设置好所有参数和输出目录，再批量拖入视频

---

## 更新历史

### Version 1.0 (2026-02-02)
- ✅ 核心功能：视频帧提取
- ✅ 多输入模式：单文件、目录、多文件
- ✅ ROI 裁剪功能
- ✅ 灵活帧采样控制
- ✅ 实时预览和进度反馈
- ✅ 中文界面支持

---

## 联系与支持

如遇到问题或有功能建议，欢迎反馈。

---

## 许可证

本项目采用 MIT 许可证。

---

## 开发者

drag2frames - 视频帧提取工具
版本：1.0
发布日期：2026年2月2日
